#include "macros.asc"

  ORG  0x0100

START:
  LD   A, 0x01
  CP   0x02
  JP   Z, LABEL_1
  CP   0x01
  JP   NZ, LABEL_1
  JP   LABEL_2
  HALT

  DEFB 0xff

LABEL_2:
  CALL LABEL_3
  JP   LABEL_1

LABEL_3:
  POP  HL
  LD   A, H
  CP   0x01
  JP   Z, LABEL_4
  JP   LABEL_1

LABEL_4:
  LD   A, L
  CP   0x14
  JP   Z, LABEL_5
  JP   LABEL_1

LABEL_5:
  LD   SP, 0x04ac
  POP  AF
  POP  BC
  POP  DE
  POP  HL
  EX   AF, AF'
  EXX
  POP  AF
  POP  BC
  POP  DE
  POP  HL
  POP  IX
  POP  IY
  LD   SP, 0x04d4
  PUSH IY
  PUSH IX
  PUSH HL
  PUSH DE
  PUSH BC
  PUSH AF
  EX   AF, AF'
  EXX
  PUSH HL
  PUSH DE
  PUSH BC
  PUSH AF

  LD   A, (0x04c0)
  CP   0x02
  JP   NZ, LABEL_1
  LD   A, (0x04c1)
  CP   0x04
  JP   NZ, LABEL_1
  LD   A, (0x04c2)
  CP   0x06
  JP   NZ, LABEL_1
  LD   A, (0x04c3)
  CP   0x08
  JP   NZ, LABEL_1
  LD   A, (0x04c4)
  CP   0x0a
  JP   NZ, LABEL_1
  LD   A, (0x04c5)
  CP   0x0c
  JP   NZ, LABEL_1
  LD   A, (0x04c6)
  CP   0x0e
  JP   NZ, LABEL_1
  LD   A, (0x04c7)
  CP   0x10
  JP   NZ, LABEL_1
  LD   A, (0x04c8)
  CP   0x12
  JP   NZ, LABEL_1
  LD   A, (0x04c9)
  CP   0x14
  JP   NZ, LABEL_1
  LD   A, (0x04ca)
  CP   0x16
  JP   NZ, LABEL_1
  LD   A, (0x04cb)
  CP   0x18
  JP   NZ, LABEL_1
  LD   A, (0x04cc)
  CP   0x1a
  JP   NZ, LABEL_1
  LD   A, (0x04cd)
  CP   0x1c
  JP   NZ, LABEL_1
  LD   A, (0x04ce)
  CP   0x1e
  JP   NZ, LABEL_1
  LD   A, (0x04cf)
  CP   0x20
  JP   NZ, LABEL_1
  LD   A, (0x04d0)
  CP   0x22
  JP   NZ, LABEL_1
  LD   A, (0x04d1)
  CP   0x24
  JP   NZ, LABEL_1
  LD   A, (0x04d2)
  CP   0x26
  JP   NZ, LABEL_1
  LD   A, (0x04d3)
  CP   0x28
  JP   NZ, LABEL_1

  LD   HL, 0x04d4
  LD   A, (HL)
  CP   0xa5
  JP   NZ, LABEL_1
  LD   HL, 0x04d5
  LD   A, (HL)
  CP   0x3c
  JP   NZ, LABEL_1

  LD   SP, 0x0600
  LD   HL, 0x0209
  PUSH HL
  RET
  JP   LABEL_1

  LD   A, 0xff
  AND  0x0f
  CP   0x0f
  JP   NZ, LABEL_1

  LD   A, 0x5a
  AND  0x0f
  CP   0x0a
  JP   NZ, LABEL_1

  RRCA
  CP   0x05
  JP   NZ, LABEL_1

  RRCA
  CP   0x82
  JP   NZ, LABEL_1

  RRCA
  CP   0x41
  JP   NZ, LABEL_1

  RRCA
  CP   0xa0
  JP   NZ, LABEL_1

  LD   HL, 0x1234
  PUSH HL
  POP  BC
  LD   A, B
  CP   0x12
  JP   NZ, LABEL_1
  LD   A, C
  CP   0x34
  JP   NZ, LABEL_1

  LD   HL, 0x0001
  PUSH HL
  POP  AF
  CALL C, LABEL_6
  JP   LABEL_7
LABEL_6:
  POP  HL
  LD   HL, 0x00d6
  PUSH HL
  POP  AF
  CALL NC, LABEL_8
  JP   LABEL_7
LABEL_8:
  POP  HL
  LD   HL, 0x0269
  PUSH HL
  LD   HL, 0x0001
  PUSH HL
  POP  AF
  RET  C
  CALL LABEL_7
  LD   HL, 0x0276
  PUSH HL
  LD   HL, 0x00d6
  PUSH HL
  POP  AF
  RET  NC
  CALL LABEL_7
  LD   HL, 0x0001
  PUSH HL
  POP  AF
  JP   C, LABEL_9
  CALL LABEL_7
LABEL_9:
  LD   HL, 0x00d6
  PUSH HL
  POP  AF
  JP   NC, LABEL_10
  CALL LABEL_7
LABEL_10:
  LD   HL, 0x0001
  PUSH HL
  POP  AF
  JR   C, LABEL_11
  CALL LABEL_7
LABEL_11:
  LD   HL, 0x00d6
  PUSH HL
  POP  AF
  JR   NC, LABEL_12
  CALL LABEL_7
LABEL_12:
  LD   HL, 0x0004
  PUSH HL
  POP  AF
  CALL PE, LABEL_13
  JP   LABEL_7
LABEL_13:
  POP  HL
  LD   HL, 0x00d3
  PUSH HL
  POP  AF
  CALL PO, LABEL_14
  JP   LABEL_7
LABEL_14:
  POP  HL
  LD   HL, 0x02c5
  PUSH HL
  LD   HL, 0x0004
  PUSH HL
  POP  AF
  RET  PE
  CALL LABEL_7
  LD   HL, 0x02d2
  PUSH HL
  LD   HL, 0x00d3
  PUSH HL
  POP  AF
  RET  PO
  CALL LABEL_7
  LD   HL, 0x0004
  PUSH HL
  POP  AF
  JP   PE, LABEL_15
  CALL LABEL_7
LABEL_15:
  LD   HL, 0x00d3
  PUSH HL
  POP  AF
  JP   PO, LABEL_16
  CALL LABEL_7
LABEL_16:
  LD   HL, 0x0040
  PUSH HL
  POP  AF
  CALL Z, LABEL_17
  JP   LABEL_7
LABEL_17:
  POP  HL
  LD   HL, 0x0097
  PUSH HL
  POP  AF
  CALL NZ, LABEL_18
  JP   LABEL_7
LABEL_18:
  POP  HL
  LD   HL, 0x030d
  PUSH HL
  LD   HL, 0x0040
  PUSH HL
  POP  AF
  RET  Z
  CALL LABEL_7
  LD   HL, 0x031a
  PUSH HL
  LD   HL, 0x0097
  PUSH HL
  POP  AF
  RET  NZ
  CALL LABEL_7
  LD   HL, 0x0040
  PUSH HL
  POP  AF
  JP   Z, LABEL_19
  CALL LABEL_7
LABEL_19:
  LD   HL, 0x0097
  PUSH HL
  POP  AF
  JP   NZ, LABEL_20
  CALL LABEL_7
LABEL_20:
  LD   HL, 0x0040
  PUSH HL
  POP  AF
  JR   Z, LABEL_21
  CALL LABEL_7
LABEL_21:
  LD   HL, 0x0097
  PUSH HL
  POP  AF
  JR   NZ, LABEL_22
  CALL LABEL_7
LABEL_22:
  LD   HL, 0x0080
  PUSH HL
  POP  AF
  CALL M, LABEL_23
  JP   LABEL_7
LABEL_23:
  POP  HL
  LD   HL, 0x0057
  PUSH HL
  POP  AF
  CALL P, LABEL_24
  JP   LABEL_7
LABEL_24:
  POP  HL
  LD   HL, 0x0369
  PUSH HL
  LD   HL, 0x0080
  PUSH HL
  POP  AF
  RET  M
  CALL LABEL_7
  LD   HL, 0x0376
  PUSH HL
  LD   HL, 0x0057
  PUSH HL
  POP  AF
  RET  P
  CALL LABEL_7
  LD   HL, 0x0080
  PUSH HL
  POP  AF
  JP   M, LABEL_25
  CALL LABEL_7
LABEL_25:
  LD   HL, 0x0057
  PUSH HL
  POP  AF
  JP   P, LABEL_26
  CALL LABEL_7

LABEL_26:
  LD   HL, 0x0393
  JP   HL
  CALL LABEL_7

  LD   HL, 0x039e
  PUSH HL
  POP  IX
  JP   IX
  CALL LABEL_7

  LD   HL, 0x03a9
  PUSH HL
  POP  IY
  JP   IY
  CALL LABEL_7

  LD   A, 0xa5
  LD   B, 0x04
LABEL_27:
  RRCA
  DJNZ LABEL_27
  CP   0x5a
  CALL NZ, LABEL_7

  LD   B, 0x10
LABEL_28:
  INC  A
  DJNZ LABEL_28
  CP   0x6a
  CALL NZ, LABEL_7

  LD   B, 0x00
  LD   HL, 0
LABEL_29:
  INC  HL
  DJNZ LABEL_29
  LD   A, H
  CP   0x01
  CALL NZ, LABEL_7

  LD   A, L
  CP   0x00
  CALL NZ, LABEL_7

  LD   IX, 0x04d4
  LD   A, (IX+0x00)
  CP   0xa5
  CALL NZ, LABEL_7
  LD   A, (IX+0x01)
  CP   0x3c
  CALL NZ, LABEL_7
  INC  IX
  LD   A, (IX-0x01)
  CP   0xa5
  CALL NZ, LABEL_7
  LD   IX, 0x0456
  LD   A, (IX+0x7f)
  CP   0x3c
  CALL NZ, LABEL_7
  LD   IX, 0x0554
  LD   A, (IX-0x80)
  CP   0xa5
  CALL NZ, LABEL_7
  LD   IY, 0x04d4
  LD   A, (IY+0x00)
  CP   0xa5
  CALL NZ, LABEL_7
  LD   A, (IY+0x01)
  CP   0x3c
  CALL NZ, LABEL_7
  INC  IY
  LD   A, (IY-0x01)
  CP   0xa5
  CALL NZ, LABEL_7
  LD   IY, 0x0456
  LD   A, (IY+0x7f)
  CP   0x3c
  CALL NZ, LABEL_7
  LD   IY, 0x0554
  LD   A, (IY-0x80)
  CP   0xa5
  CALL NZ, LABEL_7

  LD   DE, okmsg
  LD   C, 0x09
  CALL LABEL_30
  JP   LABEL_1

okmsg:
  DEFB 'Preliminary tests complete$'

LABEL_7:
  POP  BC
  LD   H, 0x05
  LD   A, B
  RRCA
  RRCA
  RRCA
  RRCA
  AND  0x0f
  LD   L, A
  LD   A, (HL)
  CALL LABEL_33
  LD   A, B
  AND  0x0f
  LD   L, A
  LD   A, (HL)
  CALL LABEL_33
  LD   A, C
  RRCA
  RRCA
  RRCA
  RRCA
  AND  0x0f
  LD   L, A
  LD   A, (HL)
  CALL LABEL_33
  LD   A, C
  AND  0x0f
  LD   L, A
  LD   A, (HL)
  CALL LABEL_33
  LD   A, 0x0d
  CALL LABEL_33
  LD   A, 0x0a
  CALL LABEL_33
  JP   LABEL_1

LABEL_33:
  PUSH AF
  PUSH BC
  PUSH DE
  PUSH HL
  LD   C, 0x02
  LD   E, A
  CALL LABEL_30
  POP  HL
  POP  DE
  POP  BC
  POP  AF
  RET

regs1:
  DEFB 0x02 0x04 0x06 0x08 0x0a 0x0c 0x0e 0x10 0x12 0x14
  DEFB 0x16 0x18 0x1a 0x1c 0x1e 0x20 0x22 0x24 0x26 0x28

regs2:
  DEFS 20

hlval:
  DEFB 0xa5 0x3c

  ORG  0x500

hextab:
  DEFB '0123456789abcdef'

  DEFS 240

STACK:
  DEFS 240

LABEL_1:
  PRINT_STRING("CALL 0")
  HALT

LABEL_30:
  PRINT_STRING("CALL 5")
  HALT
